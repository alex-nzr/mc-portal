this.BX=this.BX||{},this.BX.Cbit=this.BX.Cbit||{},this.BX.Cbit.Mc=this.BX.Cbit.Mc||{},function(t,e){"use strict";var a=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};babelHelpers.classCallCheck(this,t),this.moduleId=e.moduleId,this.providerEntityId=e.providerEntityId,this.providerEntityType=e.providerEntityType,this.submitAddFormBtnId="add-ext-participant-submit-btn"}return babelHelpers.createClass(t,[{key:"showSelector",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=e.FIELD_NAME,i="Y"===e.MULTIPLE;if(this.tagSelector=new BX.UI.EntitySelector.TagSelector({id:"".concat(a,"_selector"),multiple:i,addButtonCaption:BX.message("SELECT_TEXT"),addButtonCaptionMore:BX.message("MORE_TEXT"),dialogOptions:{context:"EXTERNAL_PARTICIPANT_SELECTOR_CONTEXT",entities:[{id:this.providerEntityId,options:{},dynamicLoad:!0,dynamicSearch:!0}],hideOnSelect:!1,hideByEsc:!0,searchOptions:{allowCreateItem:!1,footerOptions:{label:""}},footer:BX.create("span",{props:{id:"".concat(a,"_add"),className:"ui-selector-footer-link ui-selector-footer-link-add"},text:BX.message("ADD_TEXT"),events:{click:function(){return t.showAddPopup()}}}),events:{}},events:{onAfterTagAdd:function(t){var n=t.getData().tag.id,o=BX(e.CONTAINER_ID);if(o){var r,s,d,c,l=i?"".concat(a,"_add_").concat(n):"".concat(a,"_add"),u=BX(l);u?u.value=n:(u=BX.create("input",{props:{id:l,value:n,type:"hidden",name:i?"".concat(a,"[]"):a}}),o.append(u)),null===(r=BX.Crm)||void 0===r||null===(s=r.EntityEditor)||void 0===s||null===(d=s.getDefault())||void 0===d||null===(c=d.getControlById(a))||void 0===c||c.markAsChanged()}},onAfterTagRemove:function(t){var n=t.getData().tag.id;if(BX(e.CONTAINER_ID)){var o,r,s,d,c=i?"".concat(a,"_add_").concat(n):"".concat(a,"_add"),l=BX(c);l&&(l.value=""),null===(o=BX.Crm)||void 0===o||null===(r=o.EntityEditor)||void 0===r||null===(s=r.getDefault())||void 0===s||null===(d=s.getControlById(a))||void 0===d||d.markAsChanged()}}}}),"object"===babelHelpers.typeof(e.VALUE_ITEMS))for(var n in e.VALUE_ITEMS){var o=e.VALUE_ITEMS[n];this.tagSelector.addTag({id:o.ID,entityId:this.providerEntityId,entityType:this.providerEntityType,title:{text:"".concat(o.NAME," ").concat(o.SECOND_NAME," ").concat(o.LAST_NAME)}})}this.tagSelector.renderTo(BX(e.PLACEMENT_ID))}},{key:"showAddPopup",value:function(){var t=this;this.addFormNode=this.createAddForm(),this.addFormPopup=BX.PopupWindowManager.create("add-ext-participant-popup",null,{content:this.addFormNode,width:500,closeIcon:!1,titleBar:BX.message("ADD_POPUP_TITLE"),closeByEsc:!1,overlay:{backgroundColor:"black",opacity:500},buttons:[new BX.PopupWindowButton({text:BX.message("SAVE_TEXT"),className:"ui-btn ui-btn-primary",id:this.submitAddFormBtnId,events:{click:function(){t.submitAddForm()}}}),new BX.PopupWindowButton({text:BX.message("EXIT_TEXT"),className:"ui-btn ui-btn-default",events:{click:function(){t.addFormPopup.close()}}})]}),this.addFormPopup.show()}},{key:"createAddForm",value:function(){return BX.create("form",{children:[this.createTextInput(BX.message("FIELD_NAME_LABEL"),"NAME",!0),this.createTextInput(BX.message("FIELD_SECOND_NAME_LABEL"),"SECOND_NAME",!1),this.createTextInput(BX.message("FIELD_LAST_NAME_LABEL"),"LAST_NAME",!0),this.createTextInput(BX.message("FIELD_COMPANY_LABEL"),"COMPANY",!0),this.createTextInput(BX.message("FIELD_POSITION_LABEL"),"POSITION",!0)]})}},{key:"submitAddForm",value:function(){var t=this;if(!this.validateForm(this.addFormNode))return!1;var e=BX(this.submitAddFormBtnId);e&&e.classList.add("ui-btn-wait");var a=new FormData(this.addFormNode);BX.ajax.runAction("cbit.mc:expense.base.addExternalParticipant",{sessid:BX.bitrix_sessid(),data:a}).then((function(e){if("success"!==e.status)throw new Error("Something went wrong. Unknown response status - ".response.status);if(t.addFormPopup.close(),t.addFormPopup.destroy(),e.data.ID){var a=t.tagSelector.getDialog().addItem({id:e.data.ID,entityId:t.providerEntityId,title:"".concat(e.data.NAME," ").concat(e.data.SECOND_NAME," ").concat(e.data.LAST_NAME),sort:1});a&&a.select()}})).catch((function(t){var a,i,n,o,r,s,d,c=null!==(a=null===(i=t.errors)||void 0===i||null===(n=i[0])||void 0===n?void 0:n.message)&&void 0!==a?a:"Something went wrong. Unknown error";null===(o=BX.Cbit)||void 0===o||null===(r=o.Mc)||void 0===r||null===(s=r.Core)||void 0===s||null===(d=s.MainUI)||void 0===d||d.showErrorPopup(c),e&&e.classList.remove("ui-btn-wait")}))}},{key:"validateForm",value:function(t){var e=!0,a=t.querySelectorAll("input, select, textarea");return a.length&&a.forEach((function(t){var a=t.closest(".ui-ctl");t.hasAttribute("required")&&!t.value?(a&&a.classList.add("ui-ctl-danger"),e=!1):a&&a.classList.remove("ui-ctl-danger")})),e}},{key:"createTextInput",value:function(t,e,a){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return BX.create({tag:"label",props:{className:"ui-ctl ui-ctl-textbox"},children:[BX.create({tag:"span",props:{className:"ui-ctl-tag"},text:t}),BX.create({tag:"input",props:{type:"text",name:e,className:"ui-ctl-element"},attrs:{required:a,placeholder:i}})]})}}]),t}();BX.ready((function(){try{BX.Cbit.Mc.Expense.ExternalParticipant=new a(e.Extension.getSettings("cbit.mc.expense.external-participant-selector"))}catch(t){console.log("Expense ExternalParticipant error",t)}}))}(this.BX.Cbit.Mc.Expense=this.BX.Cbit.Mc.Expense||{},BX);
//# sourceMappingURL=index.bundle.js.map
