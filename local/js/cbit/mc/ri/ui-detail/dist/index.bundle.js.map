{"version":3,"file":"index.bundle.js","sources":["../src/scripts/ui-detail.js","../src/index.js"],"sourcesContent":["/**\n * ==================================================\n * Developer: Alexey Nazarov\n * E-mail: alsnazarov@1cbit.ru\n * Copyright (c) 2019 - 2022\n * ==================================================\n * mc-portal - ui-detail.js\n * 13.07.2022 14:46\n * ==================================================\n */\n\nimport {Event as EventBX} from 'main.core';\n\nexport class UiDetail\n{\n\tconstructor(options = {})\n\t{\n\t\tthis.moduleId \t\t\t\t\t= options.moduleId;\n\t\tthis.typeId \t\t\t\t\t= options.typeId;\n\t\tthis.pullActions\t\t\t\t= options.pullActions\n\t\tthis.typeId \t\t\t\t\t= options.typeId;\n\t\tthis.entityTypeId \t\t\t\t= options.entityTypeId;\n\t\tthis.entityId \t\t\t\t\t= options.entityId;\n\t\tthis.isOnSuccessStage \t\t\t= options.isOnSuccessStage;\n\t\tthis.isOnUnassignedStages\t\t= options.isOnUnassignedStages;\n\t\tthis.isItemScored \t\t\t\t= options.isItemScored;\n\t\tthis.isItemCreatedByCurrentUser = options.isItemCreatedByCurrentUser;\n\t\tthis.isCancelReasonRequired \t= options.isCancelReasonRequired;\n\t\tthis.cancelReasonsList \t        = options.cancelReasonsList;\n\t\tthis.cancelRequestBtnDatasetId\t= options.cancelRequestBtnDatasetId;\n\t\tthis.unScoredRequests \t\t\t= options.unScoredRequests;\n\t\tthis.hasUnScoredRequests \t\t= options.hasUnScoredRequests;\n\t\tthis.isNew\t\t\t\t\t\t= options.isNew;\n\t\tthis.isAdmin\t\t\t\t\t= options.isAdmin;\n\t\tthis.hasRiPerms  \t\t\t\t= options.hasRiPerms;\n\t\tthis.readonlyFields\t\t\t\t= options.readonlyFields;\n\t\tthis.allowQuickCancelling\t\t= 'N';\n\n\t\tthis.submitScoringFormBtnId = 'submit_scoring_form_btn_id';\n\t\tthis.submitCancelFormBtnId = 'submit_cancel_form_btn_id';\n\n\t\tthis.scoreParams = {\n\t\t\tSCORING_FORM_SPEED: {\n\t\t\t\ttitle: BX.message('UI_DETAIL_SCORING_FORM_SPEED'),\n\t\t\t\tselected: false,\n\t\t\t\toptionKey: 'SCORING_FORM_SPEED'\n\t\t\t},\n\t\t\tSCORING_FORM_WORK: {\n\t\t\t\ttitle: BX.message('UI_DETAIL_SCORING_FORM_WORK'),\n\t\t\t\tselected: false,\n\t\t\t\toptionKey: 'SCORING_FORM_WORK'\n\t\t\t},\n\t\t\tSCORING_FORM_COMMUNICATIONS: {\n\t\t\t\ttitle: BX.message('UI_DETAIL_SCORING_FORM_COMMUNICATIONS'),\n\t\t\t\tselected: false,\n\t\t\t\toptionKey: 'SCORING_FORM_COMMUNICATIONS'\n\t\t\t}\n\t\t}\n\n\t\tthis.sliderEvents = {\n\t\t\tscoringCompletedEvent: 'scoringCompleted',\n\t\t}\n\n\t\tthis.init();\n\t}\n\n\tinit()\n\t{\n\t\tif((!this.isOnSuccessStage || this.isItemScored) && this.hasUnScoredRequests)\n\t\t{\n\t\t\tthis.showUnScoredItemsListPopup();\n\t\t\tthis.hideControlPanel();\n\t\t}\n\n\t\tthis.initEntityDetailManager();\n\t\tthis.initEvents();\n\t\tthis.initButtons();\n\t\tthis.addCustomStyles();\n\t}\n\n\tinitEntityDetailManager(){\n\t\tthis.entityDetailManager = new BX.Cbit.Mc.Core.EntityDetailManager({\n\t\t\tmoduleId: \t\t\t \t     this.moduleId,\n\t\t\ttypeId: \t\t\t \t     this.typeId,\n\t\t\tentityTypeId: \t\t \t     this.entityTypeId,\n\t\t\tentityId: \t\t\t \t     this.entityId,\n\t\t\tisNew:\t\t\t\t \t     this.isNew,\n\t\t\tpageTitleEditable: \t\t     false,\n\t\t\tenableCategorySelector:      false,\n\t\t\tcardConfigEditable: \t     this.isAdmin,\n\t\t\tenableCommunicationControls: false,\n\t\t\tenableSectionCreation: \t     this.isAdmin,\n\t\t\tenableSectionEdit: \t\t     this.isAdmin,\n\t\t\tenableFieldsContextMenu:     false,\n\t\t\tenableSectionEditMode: \t     this.isAdmin,\n\t\t\tshowEmptySections: \t\t     false,\n\t\t\thideTimelineInCreationPage:  true,\n\t\t\tisStageFlowActive:\t\t\t this.hasRiPerms,\n\t\t\treloadOnStageChange:\t\t true,\n\t\t});\n\t}\n\n\tinitEvents(){\n\t\tif (this.isOnSuccessStage && !this.isItemScored)\n\t\t{\n\t\t\tif (this.isItemCreatedByCurrentUser)\n\t\t\t{\n\t\t\t\tBX.addCustomEvent(\"SidePanel.Slider:onClose\", (event) => {\n\t\t\t\t\tevent.denyAction();\n\t\t\t\t\tthis.showScoringPopup(this.entityId);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tBX.addCustomEvent(\"onPullEvent\", BX.delegate(function(moduleId, command, params){\n\t\t\tif ((moduleId === this.moduleId) && (Number(params.itemId) === Number(this.entityId)))\n\t\t\t{\n\t\t\t\tswitch (command) {\n\t\t\t\t\tcase this.pullActions.showScoringPopup:\n\t\t\t\t\t\tthis.showScoringPopup(params.itemId);\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}, this));\n\n\t\tBX.addCustomEvent(\"SidePanel.Slider:onMessage\", (event) => {\n\t\t\tif (event.eventId === this.sliderEvents.scoringCompletedEvent)\n\t\t\t{\n\t\t\t\tconst itemId = event.data?.itemId;\n\t\t\t\tif (itemId)\n\t\t\t\t{\n\t\t\t\t\tthis.updateUnScoredRequestsData(itemId);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tBX.addCustomEvent('BX.UI.EntityEditorField:onLayout', (event) => {\n\t\t\tif (event._id === `UF_CRM_${this.typeId}_ATTACHMENTS`)\n\t\t\t{\n\t\t\t\tif (event._wrapper)\n\t\t\t\t{\n\t\t\t\t\tconst nodes = event._wrapper.querySelectorAll(`del, [data-bx-role=\"file-delete\"]`);\n\t\t\t\t\tnodes.length && nodes.forEach(node => {\n\t\t\t\t\t\tnode.remove();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (event._id === `UF_CRM_${this.typeId}_MAX_BUDGET`)\n\t\t\t{\n\t\t\t\tif (event._wrapper)\n\t\t\t\t{\n\t\t\t\t\tevent._wrapper.querySelector('.ui-entity-editor-block-title').append(\n\t\t\t\t\t\tBX.UI.Hint.createNode(BX.message('UI_DETAIL_MAX_BUDGET_HINT'))\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tEventBX.EventEmitter.subscribe('BX.Main.Popup:onShow', (event) => {\n\t\t\tconst id = event.target.popupContainer ? event.target.popupContainer.getAttribute('id') : '';\n\t\t\tif (id && (id.indexOf(\"calendar_popup\") === 0))\n\t\t\t{\n\t\t\t\tconst cells \t= event.target.popupContainer.querySelectorAll(\".bx-calendar-cell\");\n\t\t\t\tconst timestamp = (new Date()).getTime();\n\n\t\t\t\tcells.length && cells.forEach(cell => {\n\t\t\t\t\tconst cellTime = Number(cell.dataset.date);\n\t\t\t\t\tif ((timestamp - cellTime) > 24*60*60*1000)\n\t\t\t\t\t{\n\t\t\t\t\t\tcell.classList.add('bx-calendar-date-hidden', 'disabled');\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t})\n\t}\n\n\tupdateUnScoredRequestsData(itemId) {\n\t\tthis.rebuildUnScoredRequests(itemId);\n\n\t\tif (this.unScoredListPopup)\n\t\t{\n\t\t\tthis.unScoredListPopup.close();\n\t\t\tthis.unScoredListPopup.destroy();\n\t\t\tthis.unScoredListPopup = null;\n\t\t}\n\n\t\tif (Object.keys(this.unScoredRequests).length > 0)\n\t\t{\n\t\t\tthis.showUnScoredItemsListPopup();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.showControlPanel();\n\t\t}\n\t}\n\n\tshowScoringPopup(itemId) {\n\t\tthis.scoringFormNode = this.createScoringForm(itemId);\n\t\tthis.scoringFormPopup = BX.PopupWindowManager.create(\n\t\t\t\"request-scoring-popup\",\n\t\t\tnull,\n\t\t\t{\n\t\t\t\tcontent: this.scoringFormNode,\n\t\t\t\twidth: 700,\n\t\t\t\tcloseIcon: false,\n\t\t\t\ttitleBar: BX.message('UI_DETAIL_SCORING_POPUP_TITLE'),\n\t\t\t\tcloseByEsc: false,\n\t\t\t\toverlay: {\n\t\t\t\t\tbackgroundColor: 'black',\n\t\t\t\t\topacity: 500\n\t\t\t\t},\n\t\t\t\tbuttons: [\n\t\t\t\t\tnew BX.PopupWindowButton({\n\t\t\t\t\t\ttext: BX.message('SAVE_TEXT'),\n\t\t\t\t\t\tclassName: 'ui-btn ui-btn-primary',\n\t\t\t\t\t\tid: this.submitScoringFormBtnId,\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\t\tthis.submitScoringFrom();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t\t/*new BX.PopupWindowButton({\n\t\t\t\t\t\ttext: BX.message('EXIT_TEXT'),\n\t\t\t\t\t\tclassName: 'ui-btn ui-btn-default',\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\t\tthis.scoringFormPopup.close();\n\t\t\t\t\t\t\t\tthis.scoringFormPopup.destroy();\n\t\t\t\t\t\t\t\tthis.scoringFormPopup = null;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})*/\n\t\t\t\t],\n\t\t\t}\n\t\t);\n\t\tthis.scoringFormPopup.show();\n\t}\n\n\tcreateScoringForm(itemId) {\n\t\tthis.scoreParams.SCORING_FORM_SPEED.selected = false;\n\t\tthis.scoreParams.SCORING_FORM_WORK.selected = false;\n\t\tthis.scoreParams.SCORING_FORM_COMMUNICATIONS.selected = false;\n\n\t\treturn BX.create({\n\t\t\ttag: 'form',\n\t\t\tprops: {\n\t\t\t\tid: 'staffing-emp-needle-add-form'\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tthis.createScoringBlock(this.scoreParams.SCORING_FORM_SPEED),\n\t\t\t\tthis.createScoringBlock(this.scoreParams.SCORING_FORM_WORK),\n\t\t\t\tthis.createScoringBlock(this.scoreParams.SCORING_FORM_COMMUNICATIONS),\n\n\t\t\t\tBX.create({\n\t\t\t\t\ttag: 'label',\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: 'ui-ctl ui-ctl-textarea ui-ctl-no-resize'\n\t\t\t\t\t},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tBX.create({\n\t\t\t\t\t\t\ttag: 'span',\n\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\tclassName: 'ui-ctl-tag'\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ttext: BX.message('UI_DETAIL_SCORING_FORM_COMMENT')\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tBX.create({\n\t\t\t\t\t\t\ttag: 'textarea',\n\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\tname: 'SCORING_FORM_COMMENT',\n\t\t\t\t\t\t\t\tclassName: 'ui-ctl-element'\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t}),\n\n\t\t\t\tBX.create('input', {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\ttype: 'hidden',\n\t\t\t\t\t\tname: 'ITEM_ID',\n\t\t\t\t\t\tvalue: itemId\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\t}\n\n\tsubmitScoringFrom(){\n\t\tif (!this.validateScoringForm())\n\t\t{\n\t\t\tBX.Cbit?.Mc?.Core?.MainUI?.showErrorPopup(BX.message('UI_DETAIL_SCORING_FORM_WARNING'));\n\t\t\treturn false;\n\t\t}\n\n\t\tconst submitBtn =  BX(this.submitScoringFormBtnId);\n\t\tsubmitBtn && submitBtn.classList.add(\"ui-btn-wait\");\n\n\t\tconst formData = new FormData(this.scoringFormNode);\n\n\t\tBX.ajax.runAction('cbit.mc:ri.base.setRequestScore', {\n\t\t\tsessid: BX.bitrix_sessid(),\n\t\t\tdata: formData\n\t\t}).then( response => {\n\t\t\tif (response.status === 'success')\n\t\t\t{\n\t\t\t\tthis.scoringFormPopup.close();\n\t\t\t\tthis.scoringFormPopup.destroy();\n\t\t\t\tthis.scoringFormPopup = null;\n\t\t\t\tthis.scoringFormNode  = null;\n\n\t\t\t\tBX.Cbit?.Mc?.Core?.MainUI?.showSuccessPopup();\n\t\t\t\tBX.Crm.EntityEditor.getDefault().refreshLayout();\n\t\t\t\tBX.SidePanel.Instance.postMessage(\n\t\t\t\t\tBX.SidePanel.Instance.getTopSlider().getUrl(),\n\t\t\t\t\tthis.sliderEvents.scoringCompletedEvent,\n\t\t\t\t\t{\n\t\t\t\t\t\titemId: this.entityId\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tBX.SidePanel.Instance.reload();\n\t\t\t\t}, 1000);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthrow new Error('Something went wrong. Unknown response status - '.response.status);\n\t\t\t}\n\t\t}).catch(response => {\n\t\t\tconst error = response.errors?.[0]?.message ?? 'Something went wrong. Unknown error';\n\t\t\tBX.Cbit?.Mc?.Core?.MainUI?.showErrorPopup(error);\n\t\t\tsubmitBtn && submitBtn.classList.remove(\"ui-btn-wait\");\n\t\t});\n\t}\n\n\tvalidateScoringForm() {\n\t\treturn (\n\t\t\tthis.scoreParams.SCORING_FORM_SPEED.selected\n\t\t\t&& this.scoreParams.SCORING_FORM_WORK.selected\n\t\t\t&& this.scoreParams.SCORING_FORM_COMMUNICATIONS.selected\n\t\t);\n\t}\n\n\tcreateScoringBlock(params) {\n\t\treturn BX.create({\n\t\t\ttag: 'div',\n\t\t\tprops: {\n\t\t\t\tclassName: 'score-selection-wrapper',\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tBX.create({\n\t\t\t\t\ttag: 'h3',\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: 'score-selection-title',\n\t\t\t\t\t},\n\t\t\t\t\ttext: params.title\n\t\t\t\t}),\n\t\t\t\tBX.create({\n\t\t\t\t\ttag: 'div',\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: 'score-selection-stars',\n\t\t\t\t\t},\n\t\t\t\t\tchildren: this.createScoringStars(params)\n\t\t\t\t}),\n\t\t\t]\n\t\t});\n\t}\n\n\tcreateScoringStars(params) {\n\t\tconst stars = [];\n\t\tfor (let i = 1; i <= 5; i++) {\n\t\t\tstars.push(\n\t\t\t\tBX.create('img', {\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tclassName: 'score-selection-stars-item',\n\t\t\t\t\t\tsrc: this.getStarImgInBase64(),\n\t\t\t\t\t\tid: `${params.optionKey}_${i}`\n\t\t\t\t\t},\n\t\t\t\t\tdataset: {\n\t\t\t\t\t\tscore: i\n\t\t\t\t\t},\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: (e) => {\n\t\t\t\t\t\t\tconst targetScore = Number(e.target.dataset.score);\n\t\t\t\t\t\t\tconst input = BX(`${params.optionKey}_input`);\n\t\t\t\t\t\t\tif (input)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tinput.value = targetScore;\n\t\t\t\t\t\t\t\tthis.scoreParams[params.optionKey].selected = true;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst parent = e.target.closest('.score-selection-stars');\n\t\t\t\t\t\t\tif (parent)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tconst stars = parent.querySelectorAll('.score-selection-stars-item');\n\t\t\t\t\t\t\t\tif (stars)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tstars.forEach(star => {\n\t\t\t\t\t\t\t\t\t\tconst score = Number(star.dataset.score);\n\t\t\t\t\t\t\t\t\t\tif (score <= targetScore)\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tstar.classList.add('active');\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tstar.classList.remove('active');\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\t\tstars.push(BX.create('input', {\n\t\t\tattrs: {\n\t\t\t\ttype: 'hidden',\n\t\t\t\tid: `${params.optionKey}_input`,\n\t\t\t\tname: params.optionKey,\n\t\t\t}\n\t\t}));\n\t\treturn stars;\n\t}\n\n\tgetStarImgInBase64() {\n\t\treturn \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAACNUExURf///5+fn/Pz86Ojo1BQUExMTOvr65ubm+Pj44+Pj4ODg9vb26enp2BgYNPT0/v7+3R0dL+/v+/v71hYWFRUVN/f34eHh8/Pz/f392xsbLOzs5eXl9fX13x8fHh4eMfHx8PDw2RkZFxcXKurq4uLi3BwcLu7u6+vr+fn55OTk39/f8vLy2hoaLe3twAAADz07AYAAAAvdFJOU/////////////////////////////////////////////////////////////8AWqU49wAAAAlwSFlzAAAOwwAADsMBx2+oZAAABxpJREFUeF7tneta2zoQRWkI0FJoKJc2tKenhdLrOfX7P14TskOwLVmXWPKMtNcfILFsjz8WX7yRRweEEEIIIYQQQgghhBBCCCGE7MkLfCVuZs0M3xEnh80hviNO5s0c3xEXs6ahh74cri4WPfRkvrpY9NCPtYX00JO1hfTQk7WF9NCPjYX00IuNhfTQi42F9NCHrYX00IOthfTQg62F9NDNzkJ66GRnIT10srOQHrp4biE9dPDcQnro4LmF9HCYtoX0cJC2hfRwkLaFTXOE10mfroVNc4x3SI+uhU1zgndIj66FK/AO6dK3kB5a6VtID60YLKSHFkwW0kMLJgvpoQWjhfTQiNlCemjEbCE9NGKxkB4asFlIDw3YLKSHBqwW0sMedgvpYQ+7hfSwx4CF9LDDMS6LGXrY4gSXxQw9bIGrYgNbkTXDFtLDFsMW0sMWuCZ2sB1xW9g0L7ElcVrYNK+wJXFbSA+fcFtID59wW0gPn8D1GAbb1o6PhfQQ+FhIDwGuhgtsXTd+FtLDR/wspIeP4Fq4wfY142shPVzhayE9XIEr4QNG1Iu/hfQwwEJ6GGJh9R6GWFi9hyEWVu8hroIvGFUnYRZW7mGYhZV7iGvgD8bVSKiFVXsYamHTnGJkheAKhICR9RFuYdO8xtjqCLewYg9RfxgYWxsxFlbrYYyF1XqI6kPB6LqIs7BSD+MsrNRD1B4OxtdErIVSPTw7TwgqjwF7SMIZag/nFc6uHvYJzN5gH7XwBnXHsbjAbmrgYoGqo3mLPZXPW1S8D5dX2FnZXF+i3j0ZeiS3FMZrxXiDPZbLDSodg8U77LRM3u39l73Ne+y3RN6jxvFY3mLXpXGbpM3uB+y9LD6gurE5Hmy+oJKjhE9ff8QxSuEj6krDaxylDP5BValYfMKB9PPvyB8YTHzGsbTzBfWkZXaHw2nmPltf/q84ol6+opIcvMQxtZJ5mpfmxPkBNeRDb+I8/q2gG6WJ87clzj8zGhPn7zj3/KhLnK8nbcSlK3Geug2XpsR5zOw4DjWJ82mGW0E3OhLnzzjbqVGQON8JWqJNeuL8A+cpA9mJ80+cpRjkJs6/cIaSkJo4p86O4xCZOO8/jSgV8hLnMaYRpWK2z1TR8bkaaRpRKiQlzvGTaXMhJ3Ge/lbQAxmJ89jTiFIhIXGeIjuOYzl14nw7UXYcx7SJc6ppRKm4vMaJ52eucBGHqRLntNOIUjFN4qz12c0JEudPSj4wmMidOEvJjuOY5UyczwVlx3HkS5xzTiNKxfERiklMId2iciTO5fRsS58467kVdLNI+3f+XNWtoJO08fwdjlIIqCoVij+K9kn94XS6KWoJSP1PsqI8RE3pKMjD9LeIBXmY/l/VBXmIilJSjIc5gppiPMwxYaQYD1FPWgrx8AvKSUshHn5DOWkpxENUk5oiPMxjYSEe5rGwEA9RS3oK8DCXhUV4mMvCIjxEJTlQ72E+CwvwMJ+FTXOPY6oFdeRB+X/Ecloo7Um5YHJaqN5DVJEL1R7mtVC5h3ktVO4hasiHYg9zW6jaw9wWqvYQFeRErYffUUBO1HoY3XXyJHq5J7UeLnD+wayfKImehqrUw0gL8UTJ4jd+DkSph3EW7p4oiWt8oNPDKAtb3YjiWu2q9DDGwu4TJT/weggqPYz4teg/URLR+ECjh+EWmp8o+YV3/VHoYbCFtkXNghsfKPQw0MIL++9DaKvdK4zTQ6CFw92IAhsfqHtGM8hC56JmYa12x1v3KxMhFvoUd4ZtfZhjjBZCLPTrRhTS+ECZh/4WencjWjxghBtlHnpb+B8G+OA9n16Xh74W/h8mjHerXVUeeloY3o3oD0Y6UOWhl4VRi5r5tdrV5KGXhbGNab0aHyjy0EeW+Ma0PomzIg/vccp29lrUzKPVrh4PlzhjO/suauZOnNV46Mo37/dvTOtMnNV46LBwnG5Ejla7Wjx0WDhWNyJH4qzEw0ELx1zUbLDVrhIPhywctxvRUOKsw8MBC0df1GwocVbhod3CP9hiTOyJswoPbRYmWtTMmjhr8NBmYbpFzWytdhV0DbZYmLKTvSVxnnrNOQ+MFv5O+3SbpdUu3pWL0cL0jWmNibN4Dw0WZlnUzJQ4i/ewb2GuqQeGVrt4Ryp9C/M1pu0nzsI97FqYd1GzbuIs3MOOhbZpRKnoJs54WSZtCydY1KyTOIv2sGXhNIuatRJn0R4+WxJlskXNWokzXpPIDKe4Ysp7/meJs2APd7e00y5qtkucBXu4/aAz/aJmT4kzfpbH1kIJney3ibNYDzcW3srIc5E4i/Xw0UI5i5ptEmf8II21hVHTiFLxmDgL9XBlobRFzVanJNTDucD1rW+Eerg8nfwDg4HFg/DlkQkhhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCEkDQcHfwEA068zT9RMZQAAAABJRU5ErkJggg==\";\n\t}\n\n\tinitButtons() {\n\t\tthis.cancelBtn = document.querySelector(`[data-id=\"${this.cancelRequestBtnDatasetId}\"]`);\n\t\tthis.cancelBtn && this.cancelBtn.addEventListener('click', this.initCancelling.bind(this));\n\t}\n\n\tinitCancelling(){\n\t\tthis.showCancelPopup();\n\t\t/*\n\t\tthis.cancelBtn && this.cancelBtn.classList.add('ui-btn-wait');\n\t\tthis.getCurrentStagePromise()\n\t\t\t.then( response => {\n\t\t\t\tif (response.status === 'success')\n\t\t\t\t{\n\t\t\t\t\tthis.currentStage = response.data.currentStage;\n\t\t\t\t\tthis.allowQuickCancelling = response.data.allowQuickCancelling;\n\n\t\t\t\t\tif (this.allowQuickCancelling === 'Y')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.showCancelConfirm();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.showCancelPopup();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.cancelBtn && this.cancelBtn.classList.remove('ui-btn-wait');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthrow new Error('Something went wrong. Unknown response status - '.response.status);\n\t\t\t\t}\n\t\t\t}).catch(response => {\n\t\t\t\tconst error = response.errors?.[0]?.message ?? 'Something went wrong. Unknown error';\n\t\t\t\tBX.Cbit?.Mc?.Core?.MainUI?.showErrorPopup(error);\n\t\t\t\tthis.cancelBtn && this.cancelBtn.classList.remove('ui-btn-wait');\n\t\t\t});\n\t\t*/\n\t}\n\n\tgetCurrentStagePromise(){\n\t\treturn BX.ajax.runAction('cbit.mc:ri.base.getCurrentStage', {\n\t\t\tsessid: BX.bitrix_sessid(),\n\t\t\tdata: {\n\t\t\t\titemId: this.entityId\n\t\t\t}\n\t\t})\n\t}\n\n\tshowCancelConfirm() {\n\t\tBX.UI.Dialogs.MessageBox.confirm(\n\t\t\tBX.message('UI_DETAIL_CANCEL_CONFIRM_TITLE'),\n\t\t\t(messageBox) => {\n\t\t\t\tmessageBox.close();\n\t\t\t\tBX.ajax.runAction('cbit.mc:ri.base.cancelRequestWithoutReason', {\n\t\t\t\t\tsessid: BX.bitrix_sessid(),\n\t\t\t\t\tdata: {\n\t\t\t\t\t\titemId: this.entityId\n\t\t\t\t\t}\n\t\t\t\t}).then( response => {\n\t\t\t\t\tif (response.status === 'success')\n\t\t\t\t\t{\n\t\t\t\t\t\tBX.Crm.EntityEditor.getDefault().refreshLayout();\n\t\t\t\t\t\tBX.SidePanel.Instance.reload();\n\t\t\t\t\t\tthis.cancelBtn && this.cancelBtn.remove();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthrow new Error('Something went wrong. Unknown response status - '.response.status);\n\t\t\t\t\t}\n\t\t\t\t}).catch(response => {\n\t\t\t\t\tconst error = response.errors?.[0]?.message ?? 'Something went wrong. Unknown error';\n\t\t\t\t\tBX.Cbit?.Mc?.Core?.MainUI?.showErrorPopup(error);\n\t\t\t\t});\n\t\t\t},\n\t\t\t(messageBox) => {\n\t\t\t\tmessageBox.close();\n\t\t\t}\n\t\t);\n\t}\n\n\tshowCancelPopup() {\n\t\tthis.cancelFormNode = this.createCancelForm();\n\t\tthis.cancelFormPopup = BX.PopupWindowManager.create(\n\t\t\t\"request-cancelling-popup\",\n\t\t\tnull,\n\t\t\t{\n\t\t\t\tcontent: this.cancelFormNode,\n\t\t\t\twidth: 500,\n\t\t\t\tcloseIcon: false,\n\t\t\t\ttitleBar: BX.message('UI_DETAIL_CANCEL_POPUP_TITLE'),\n\t\t\t\tcloseByEsc: false,\n\t\t\t\toverlay: {\n\t\t\t\t\tbackgroundColor: 'black',\n\t\t\t\t\topacity: 500\n\t\t\t\t},\n\t\t\t\tbuttons: [\n\t\t\t\t\tnew BX.PopupWindowButton({\n\t\t\t\t\t\ttext: BX.message('SAVE_TEXT'),\n\t\t\t\t\t\tclassName: 'ui-btn ui-btn-primary',\n\t\t\t\t\t\tid: this.submitCancelFormBtnId,\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\t\tthis.submitCancelForm();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t\tnew BX.PopupWindowButton({\n\t\t\t\t\t\ttext: BX.message('EXIT_TEXT'),\n\t\t\t\t\t\tclassName: 'ui-btn ui-btn-default',\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\t\tthis.cancelFormPopup.close();\n\t\t\t\t\t\t\t\tthis.cancelFormPopup.destroy();\n\t\t\t\t\t\t\t\tthis.cancelFormPopup = null;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t],\n\t\t\t}\n\t\t);\n\t\tthis.cancelFormPopup.show();\n\t}\n\n\tcreateCancelForm(){\n\t\tconst textareaProps = {\n\t\t\tname: 'CANCEL_FORM_COMMENT',\n\t\t\tclassName: 'ui-ctl-element',\n\t\t};\n\n\t\tif (this.isCancelReasonRequired)\n\t\t{\n\t\t\ttextareaProps.required = true;\n\t\t}\n\n\t\treturn BX.create('form', {\n\t\t\tchildren: [\n\t\t\t\tBX.create({\n\t\t\t\t\ttag: 'label',\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: 'ui-ctl ui-ctl-after-icon ui-ctl-dropdown'\n\t\t\t\t\t},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tBX.create('span',{\n\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\tclassName: 'ui-ctl-after ui-ctl-icon-angle'\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tBX.create({\n\t\t\t\t\t\t\ttag: 'span',\n\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\tclassName: 'ui-ctl-tag'\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ttext: BX.message('UI_DETAIL_CANCEL_FORM_REASON')\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tBX.create({\n\t\t\t\t\t\t\ttag: 'select',\n\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\tclassName: 'ui-ctl-element',\n\t\t\t\t\t\t\t\tname: 'CANCEL_FORM_REASON',\n\t\t\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tchildren: this.getCancelRequestReasonOptions()\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\tBX.create({\n\t\t\t\t\ttag: 'label',\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: 'ui-ctl ui-ctl-textarea ui-ctl-no-resize'\n\t\t\t\t\t},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tBX.create({\n\t\t\t\t\t\t\ttag: 'span',\n\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\tclassName: 'ui-ctl-tag'\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ttext: BX.message('UI_DETAIL_CANCEL_FORM_COMMENT')\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tBX.create({\n\t\t\t\t\t\t\ttag: 'textarea',\n\t\t\t\t\t\t\tprops: textareaProps\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\tBX.create('input', {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\ttype: 'hidden',\n\t\t\t\t\t\tname: 'ITEM_ID',\n\t\t\t\t\t\tvalue: this.entityId\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\t}\n\n\tgetCancelRequestReasonOptions(){\n\t\tconst options = [];\n\t\tif(typeof this.cancelReasonsList === 'object')\n\t\t{\n\t\t\tfor(let key in this.cancelReasonsList)\n\t\t\t{\n\t\t\t\toptions.push(BX.create('option', {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tvalue: key\n\t\t\t\t\t},\n\t\t\t\t\ttext: this.cancelReasonsList[key]\n\t\t\t\t}));\n\t\t\t}\n\t\t}\n\t\treturn options;\n\t}\n\n\tvalidateForm(form) {\n\t\tlet result = true;\n\n\t\tconst fields = form.querySelectorAll('input, select, textarea');\n\t\tfields.length && fields.forEach(field => {\n\t\t\tconst parent = field.closest('.ui-ctl');\n\t\t\tif (field.hasAttribute('required') && !field.value)\n\t\t\t{\n\t\t\t\tparent && parent.classList.add('ui-ctl-danger');\n\t\t\t\tresult = false;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tparent && parent.classList.remove('ui-ctl-danger');\n\t\t\t}\n\t\t})\n\n\t\treturn result;\n\t}\n\n\tsubmitCancelForm() {\n\t\tif (!this.validateForm(this.cancelFormNode))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst submitBtn =  BX(this.submitCancelFormBtnId);\n\t\tsubmitBtn && submitBtn.classList.add(\"ui-btn-wait\");\n\n\t\tconst formData = new FormData(this.cancelFormNode);\n\n\t\tBX.ajax.runAction('cbit.mc:ri.base.cancelRequest', {\n\t\t\tsessid: BX.bitrix_sessid(),\n\t\t\tdata: formData\n\t\t}).then( response => {\n\t\t\tif (response.status === 'success')\n\t\t\t{\n\t\t\t\tthis.cancelFormPopup.close();\n\t\t\t\tthis.cancelFormPopup.destroy();\n\t\t\t\tthis.cancelFormPopup = null;\n\t\t\t\tthis.cancelFormNode  = null;\n\n\t\t\t\tBX.Cbit?.Mc?.Core?.MainUI?.showSuccessPopup();\n\t\t\t\tif (BX.SidePanel?.Instance?.opened)\n\t\t\t\t{\n\t\t\t\t\tBX.SidePanel.Instance.reload();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\twindow.location.reload();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthrow new Error('Something went wrong. Unknown response status - '.response.status);\n\t\t\t}\n\t\t}).catch(response => {\n\t\t\tconst error = response.errors?.[0]?.message ?? 'Something went wrong. Unknown error';\n\t\t\tBX.Cbit?.Mc?.Core?.MainUI?.showErrorPopup(error);\n\t\t\tsubmitBtn && submitBtn.classList.remove(\"ui-btn-wait\");\n\t\t});\n\t}\n\n\tshowUnScoredItemsListPopup() {\n\t\tthis.unScoredListPopup = BX.PopupWindowManager.create(\n\t\t\t\"not-scored-requests-popup\",\n\t\t\tnull,\n\t\t\t{\n\t\t\t\tcontent: this.getUnScoredItemsNodes(),\n\t\t\t\twidth: 500,\n\t\t\t\tcloseIcon: false,\n\t\t\t\ttitleBar: BX.message('UI_DETAIL_UN_SCORED_LIST_POPUP_TITLE'),\n\t\t\t\tcloseByEsc: false,\n\t\t\t\toverlay: {\n\t\t\t\t\tbackgroundColor: 'black',\n\t\t\t\t\topacity: 500\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t\tthis.unScoredListPopup.show();\n\t}\n\n\tgetUnScoredItemsNodes(){\n\t\tconst items = [];\n\t\tfor (const key in this.unScoredRequests)\n\t\t{\n\t\t\tif (this.unScoredRequests.hasOwnProperty(key))\n\t\t\t{\n\t\t\t\titems.push(BX.create('p',{\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: 'not-scored-requests-list-item'\n\t\t\t\t\t},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tBX.create('span',{\n\t\t\t\t\t\t\ttext: `${this.unScoredRequests[key].NUMBER}. ${this.unScoredRequests[key].TITLE}. `\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tBX.create('a',{\n\t\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\t\thref: this.unScoredRequests[key].URL\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ttext: BX.message('UI_DETAIL_UN_SCORED_LIST_ITEM_LINK')\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t}));\n\t\t\t}\n\t\t}\n\n\t\treturn BX.create('div', {\n\t\t\tprops: {\n\t\t\t\tclassName: 'not-scored-requests-list'\n\t\t\t},\n\t\t\tchildren: items\n\t\t});\n\t}\n\n\taddCustomStyles(){\n\t\tif (!this.hasRiPerms)\n\t\t{\n\t\t\tdocument.body.classList.add('internal-staff-interface');\n\t\t\tif (!this.isItemCreatedByCurrentUser)\n\t\t\t{\n\t\t\t\tdocument.body.classList.add('internal-staff-interface-not-requester');\n\t\t\t}\n\t\t}\n\n\t\tif (this.isOnUnassignedStages)\n\t\t{\n\t\t\tdocument.body.classList.add('unassigned-stages-interface');\n\t\t}\n\t}\n\n\thideControlPanel(){\n\t\tconst editor = BX.Crm?.EntityEditor?.getDefault();\n\t\teditor && editor._toolPanel?.setVisible(false);\n\t}\n\n\tshowControlPanel(){\n\t\tconst editor = BX.Crm?.EntityEditor?.getDefault();\n\t\teditor && editor._toolPanel?.setVisible(true);\n\t}\n\n\trebuildUnScoredRequests(itemId) {\n\t\tconst newObj = {};\n\t\tfor (const key in this.unScoredRequests) {\n\t\t\tif (this.unScoredRequests.hasOwnProperty(key))\n\t\t\t{\n\t\t\t\tif (Number(key) !== Number(itemId))\n\t\t\t\t{\n\t\t\t\t\tnewObj[key] = this.unScoredRequests[key];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis.unScoredRequests = newObj;\n\t}\n}","import {UiDetail} from './scripts/ui-detail';\r\nimport './styles/style.css';\r\nimport {Extension} from 'main.core';\r\n\r\nBX.ready(() => {\r\n    try\r\n    {\r\n        BX.Cbit.Mc.RI.UiDetail = new UiDetail(Extension.getSettings('cbit.mc.ri.ui-detail'));\r\n    }\r\n    catch (e)\r\n    {\r\n        console.log('R&I UiDetail error', e)\r\n    }\r\n});"],"names":["UiDetail","options","moduleId","typeId","pullActions","entityTypeId","entityId","isOnSuccessStage","isOnUnassignedStages","isItemScored","isItemCreatedByCurrentUser","isCancelReasonRequired","cancelReasonsList","cancelRequestBtnDatasetId","unScoredRequests","hasUnScoredRequests","isNew","isAdmin","hasRiPerms","readonlyFields","allowQuickCancelling","submitScoringFormBtnId","submitCancelFormBtnId","scoreParams","SCORING_FORM_SPEED","title","BX","message","selected","optionKey","SCORING_FORM_WORK","SCORING_FORM_COMMUNICATIONS","sliderEvents","scoringCompletedEvent","init","this","showUnScoredItemsListPopup","hideControlPanel","initEntityDetailManager","initEvents","initButtons","addCustomStyles","entityDetailManager","Cbit","Mc","Core","EntityDetailManager","pageTitleEditable","enableCategorySelector","cardConfigEditable","enableCommunicationControls","enableSectionCreation","enableSectionEdit","enableFieldsContextMenu","enableSectionEditMode","showEmptySections","hideTimelineInCreationPage","isStageFlowActive","reloadOnStageChange","addCustomEvent","event","denyAction","_this","showScoringPopup","delegate","command","params","Number","itemId","eventId","data","_event$data","updateUnScoredRequestsData","_id","_wrapper","nodes","querySelectorAll","length","forEach","node","remove","querySelector","append","UI","Hint","createNode","EventBX","EventEmitter","subscribe","id","target","popupContainer","getAttribute","indexOf","cells","timestamp","Date","getTime","cell","cellTime","dataset","date","classList","add","rebuildUnScoredRequests","unScoredListPopup","close","destroy","Object","keys","showControlPanel","scoringFormNode","createScoringForm","scoringFormPopup","PopupWindowManager","create","content","width","closeIcon","titleBar","closeByEsc","overlay","backgroundColor","opacity","buttons","PopupWindowButton","text","className","events","click","_this2","submitScoringFrom","show","tag","props","children","createScoringBlock","name","type","value","validateScoringForm","MainUI","showErrorPopup","submitBtn","formData","FormData","ajax","runAction","sessid","bitrix_sessid","then","response","status","Error","_this3","showSuccessPopup","Crm","EntityEditor","getDefault","refreshLayout","SidePanel","Instance","postMessage","getTopSlider","getUrl","setTimeout","reload","error","errors","_response$errors","_response$errors$","createScoringStars","stars","i","push","attrs","src","getStarImgInBase64","score","e","targetScore","input","_this4","parent","closest","star","cancelBtn","document","addEventListener","initCancelling","bind","showCancelPopup","Dialogs","MessageBox","confirm","messageBox","_this5","_response$errors2","_response$errors2$","cancelFormNode","createCancelForm","cancelFormPopup","_this6","submitCancelForm","textareaProps","required","getCancelRequestReasonOptions","babelHelpers","key","form","result","fields","field","hasAttribute","validateForm","_this7","_BX$SidePanel","_BX$SidePanel$Instanc","opened","window","location","_response$errors3","_response$errors3$","getUnScoredItemsNodes","items","hasOwnProperty","NUMBER","TITLE","href","URL","body","editor","_BX$Crm","_BX$Crm$EntityEditor","_toolPanel","_editor$_toolPanel","setVisible","_BX$Crm2","_BX$Crm2$EntityEditor","_editor$_toolPanel2","newObj","ready","RI","Extension","getSettings","console","log"],"mappings":"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"}